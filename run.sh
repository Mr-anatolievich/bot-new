#!/bin/bash

# –í–∏—Ö—ñ–¥ –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ –±—É–¥—å-—è–∫–æ—ó –∫–æ–º–∞–Ω–¥–∏
set -e

echo "üöÄ –ó–∞–ø—É—Å–∫–∞—î–º–æ Arbitrage Bot..."

# 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞, —è–∫—â–æ –π–æ–≥–æ –Ω–µ —ñ—Å–Ω—É—î
if [ ! -d "venv" ]; then
    echo "üì¶ –°—Ç–≤–æ—Ä—é—î–º–æ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ..."
    python3 -m venv venv
fi

# 2. –ê–∫—Ç–∏–≤–∞—Ü—ñ—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
source venv/bin/activate

# 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è pip —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
echo "üì• –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ..."
pip install --upgrade pip
pip install -r requirements.txt

# 4. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
echo "üóÉÔ∏è –û–Ω–æ–≤–ª—é—î–º–æ –±–∞–∑—É –¥–∞–Ω–∏—Ö..."
flask db upgrade

# 5. –ó–∞–ø—É—Å–∫ –ø—Ä–æ—î–∫—Ç—É
echo "üåê –ó–∞–ø—É—Å–∫–∞—î–º–æ —Å–µ—Ä–≤–µ—Ä..."
python run.py
